{% extends 'layout/base.html' %}
{% block title %}Settings | Tracc{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-12 col-sm-12 col-md-10 col-lg-8">
            <!-- Page Header -->
            <div class="text-center mb-5">
                <h2 class="fw-bold">Settings</h2>
            </div>

            <!-- Profile -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-3">Profile</h5>
                <a href="{% url 'update_profile' %}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-pencil"></i> Edit Profile
                </a>
            </div>

            <hr>

            <!-- Theme Section -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-3">Appearance</h5>
                <div class="row g-3 align-items-center">

                    <!-- Theme Select -->
                    <div class="col-12">
                        <label for="themeSelect" class="form-label">Theme</label>
                        <select id="themeSelect" class="form-select theme-select">
                            <option value="classic">Classic Clean</option>
                            <option value="serene">Serene Teal</option>
                            <option value="dusky">Dusky Rose</option>
                            <option value="midnight">Midnight Mint</option>
                            <option value="onyx-glow">Onyx Glow</option>
                            <option value="charcoal-canary">Charcoal Canary</option>
                            <option value="gold-ember">Gold Ember</option>
                            <option value="sunset-noir">Sunset Noir</option>
                        </select>
                    </div>

                    <!-- Light/Dark Toggle -->
                    <div class="col-12">
                        <label class="form-label d-block">Mode</label>
                        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                            <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
                            <label class="btn btn-outline-primary" for="btnradio1">
                                <i class="bi bi-sun"></i> Light
                            </label>

                            <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
                            <label class="btn btn-outline-primary" for="btnradio2">
                                <i class="bi bi-moon"></i> Dark
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <!-- Notifications -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-3">Notifications</h5>
                <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="dailyReminder" checked>
                <label class="form-check-label" for="dailyReminder">Daily weight reminder</label>
                </div>
                <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="weeklySummary">
                <label class="form-check-label" for="weeklySummary">Weekly progress summary</label>
                </div>
            </div>

            <hr>

            <!-- Import Logs -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-3">Import your old data</h5>
                <form method="POST" enctype="multipart/form-data" action="{% url 'import_logs' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">Upload Google Sheet CSV</label>
                        <input class="form-control" type="file" name="csv_file" id="csvFile" accept=".csv" required>
                    </div>
                    <button type="submit" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-upload"></i> Import Logs
                    </button>
                    <a href="{% url 'export_logs' %}" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-download"></i> Export Logs
                    </a>
                </form>
            </div>

            <hr>

            <!-- Account Section -->
            <div class="mb-4">
                <h5 class="fw-semibold mb-3">Account</h5>
                <a class="btn btn-outline-danger btn-sm" href="{% url 'logout' %}">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // root declared in base.html.
    const settings_root = document.documentElement;
    const toggleBtn = document.getElementById("theme-toggle"); // navbar one
    const themeSelect = document.getElementById("themeSelect");
    const radioLight = document.getElementById("btnradio1");
    const radioDark = document.getElementById("btnradio2");

    // Load saved theme family + mode
    let localFamily = localStorage.getItem("themeFamily") || "classic";
    let localMode = localStorage.getItem("themeMode") || "light";

    setTheme(localFamily, localMode);
    themeSelect.value = localFamily;

    // Handle theme select change
    themeSelect.addEventListener("change", (e) => {
        localFamily = e.target.value;
        localStorage.setItem("themeFamily", localFamily);
        setTheme(localFamily, localMode);
    });

    // Handle navbar toggle (icon button)
    if (toggleBtn) {
        toggleBtn.addEventListener("click", () => {
            localMode = localMode === "light" ? "dark" : "light";
            localStorage.setItem("themeMode", localMode);
            setTheme(localFamily, localMode);
            updateRadio(localMode);
        });
    }

    // Handle settings page radios
    radioLight.addEventListener("change", () => {
        if (radioLight.checked) {
            localMode = "light";
            localStorage.setItem("themeMode", localMode);
            setTheme(localFamily, localMode);
        }
    });

    radioDark.addEventListener("change", () => {
        if (radioDark.checked) {
            localMode = "dark";
            localStorage.setItem("themeMode", localMode);
            setTheme(localFamily, localMode);
        }
    });

    function setTheme(family, mode) {
        settings_root.setAttribute("data-theme-family", family);
        settings_root.setAttribute("data-bs-theme", mode);

        // update navbar toggle icon
        if (toggleBtn) {
            toggleBtn.innerHTML = mode === "light" 
                ? '<i class="bi bi-moon"></i>' 
                : '<i class="bi bi-sun"></i>';
        }

        // update settings page radios
        updateRadio(mode);
    }

    function updateRadio(mode) {
        if (mode === "light") {
            radioLight.checked = true;
            radioDark.checked = false;
        } else {
            radioLight.checked = false;
            radioDark.checked = true;
        }
    }
</script>
{% endblock %}
